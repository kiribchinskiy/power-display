<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <title>POWER</title>
  <style>
    html, body { height:100%; margin:0; }
    body {
      display:flex; align-items:center; justify-content:center;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
      color:#fff;
      transition: background 200ms ease;
    }
    .wrap { text-align:center; padding:24px; }
    .title { font-size: clamp(40px, 10vw, 96px); font-weight:800; letter-spacing:1px; }
    .dot { display:inline-block; width:18px; height:18px; border-radius:50%; margin-right:10px; vertical-align:middle; }
    .time { opacity:.85; margin-top:16px; font-size: clamp(14px, 3vw, 18px); }
    .small { opacity:.75; margin-top:6px; font-size: 14px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title"><span class="dot" id="dot"></span><span id="text">ЗАВАНТАЖЕННЯ…</span></div>
    <div class="time" id="time"></div>
    <div class="small" id="err"></div>
  </div>

  <script>
    const stateMap = {
      grid: { bg:"#0a6510", text:"МЕРЕЖА" },
      inverter: { bg:"#b00020", text:"ІНВЕРТОР" },
    };

    function setUI(state, updated) {
      const s = stateMap[state] || { bg:"#374151", text:"НЕВІДОМО" };
      document.body.style.background = s.bg;
      document.getElementById("text").textContent = s.text;
      document.getElementById("dot").style.background = "#ffffff";
      document.getElementById("time").textContent = updated ? ("Оновлено: " + updated) : "";
    }

    async function tick() {
      const errEl = document.getElementById("err");
      try {
        errEl.textContent = "";
        const r = await fetch("./status.json?ts=" + Date.now(), { cache: "no-store" });
        const j = await r.json();
        setUI(j.state, j.updated);
      } catch (e) {
        errEl.textContent = "Помилка читання status.json";
      }
    }

    tick();
    setInterval(tick, 5000);
  </script>
</body>
</html>
